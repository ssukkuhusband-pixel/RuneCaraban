# 다키스트 슬롯던전 - 프로토타입

모바일 가로 화면 기준 HTML 프로토타입입니다.
- 슬롯 기반 턴 전투
- 수집형 영웅 메타(뽑기/성장/사전 편성)
- 로그라이트 3지선다 보상
- 연계 배율(콤보) 전투 시스템
- 유산 결정 기반 메타 강화(브라우저 저장)
- 적 행동 의도(인텐트) 기반 전투 정보 노출
- 룬 조합 시너지(쌍룬/삼중/연계 진형/낙석 혼선)
- 영웅별 궁극기(에너지 100% 시 발동)
- 노드 변주(전투/정예/휴식/보스)
- 유물 수집 빌드(런 중 상시 효과)
- `SPIN_HEROES_기획서.html` 레퍼런스 기반 다크 네온 UI 테마
- `/Users/dongjun/Downloads/index.html` 레퍼런스 기반 글로우/쉬머/슬라이드업 연출 반영
- 런 보드 아이콘 UI(영웅/특성/유물/메타)로 정보 밀도 개선
- 전투 로그 축약 표기 + 로그 보기/숨김 토글 제공
- 메타 영웅 뽑기(중복 시 조각 획득) + 영웅별 레벨 성장 시스템
- 메타 장비 뽑기 + 영웅별 4슬롯 장착(무기/투구/갑옷/장신구)

## 실행 방법
1. `index.html`을 직접 열거나,
2. 이 폴더에서 정적 서버를 실행합니다.

```bash
python3 -m http.server 5173
```

이후 `http://localhost:5173`에 접속합니다.

## AI 이미지 생성(반자동)
- 생성 스크립트: `scripts/generate-google-assets.mjs`
- 사용 모델 기본값: `gemini-3-pro-image-preview`
- 모델 변경: `GOOGLE_IMAGE_MODEL` 환경변수 사용 (예: `gemini-3-pro-preview`)
- 배경 레퍼런스 입력: `BACKGROUND_REFERENCE_FILES` 환경변수 사용 (기본값: `assets/reference/back_refer.jpeg`)
- 영웅 레퍼런스 입력: `HERO_REFERENCE_FILES` 환경변수 사용 (기본값: `assets/reference/hero_refer.png`)
- 실행(프로토 폴더에서):

```bash
GOOGLE_API_KEY=\"<YOUR_KEY>\" node ./scripts/generate-google-assets.mjs
```

- 특정 에셋만 재생성(선택):
```bash
GOOGLE_API_KEY=\"<YOUR_KEY>\" ASSET_KEYS=\"background.battlefield\" node ./scripts/generate-google-assets.mjs
```

- `gemini-3-pro-preview` + 배경 레퍼런스로 배경만 재생성:
```bash
GOOGLE_API_KEY=\"<YOUR_KEY>\" GOOGLE_IMAGE_MODEL=\"gemini-3-pro-preview\" BACKGROUND_REFERENCE_FILES=\"assets/reference/back_refer.jpeg\" ASSET_KEYS=\"background.battlefield,background.lobby_campfire\" node ./scripts/generate-google-assets.mjs
```

- 영웅 레퍼런스로 영웅 초상 6종만 재생성:
```bash
GOOGLE_API_KEY=\"<YOUR_KEY>\" GOOGLE_IMAGE_MODEL=\"gemini-3-pro-image-preview\" HERO_REFERENCE_FILES=\"assets/reference/hero_refer.png\" ASSET_KEYS=\"hero.H1,hero.H2,hero.H3,hero.H4,hero.H5,hero.H6\" node ./scripts/generate-google-assets.mjs
```

- 생성 결과:
  - 이미지 파일: `assets/generated/heroes`, `assets/generated/enemies`, `assets/generated/backgrounds`
  - 매니페스트: `assets/generated/manifest.json`
  - 게임 연동 파일: `assets/generated/assets-manifest.js`
- 실행 후 `index.html`을 새로고침하면 생성 이미지가 영웅/적/전장에 자동 반영됩니다.

## 플레이 방법
- 메인 화면에서 좌/우 화살표로 챕터를 고른 뒤 `입장` 버튼을 누르면 전투가 시작됩니다.
- 전투 화면에서 `회전` 버튼을 누르면 룬 3개가 왼쪽부터 자동 해석되어 행동이 실행됩니다.
- 전투 승리 시 보상 카드 3개 중 1개를 선택합니다.
- 전투 도중 `일시정지`에서 `포기하고 메인`으로 즉시 로비 복귀할 수 있습니다.
- 전투 종료 모달(클리어/패배)에서도 `메인으로` 복귀할 수 있습니다.
- 총 10개 스테이지(노드)를 진행하며 마지막 스테이지는 보스입니다.
- 노드 구성은 `전투 → 전투 → 정예 → 전투 → 휴식 → 전투 → 정예 → 전투 → 휴식 → 보스` 순서입니다.
- `assets/sound/bgm.mp3`가 배경음으로 반복 재생되며, 상단 HUD의 `BGM` 버튼으로 ON/OFF할 수 있습니다.

## 메인 화면
- 모닥불 야영지 + 던전 입구 배경 로비
- 현재 선택 챕터명 노출 + 좌/우 화살표 선택 + 입장 버튼
- `영웅 목록`, `영웅 뽑기` 버튼 배치
- `데이터 초기화` 버튼으로 저장된 메타 데이터를 초기 상태로 리셋 가능

## 영웅 목록
- 보유 영웅 목록 확인
- 3열 레이아웃: 좌측(스탯/스킬) · 중앙(영웅/장비) · 우측(영웅 목록)
- 영웅 선택 시 상세 정보(레벨/스탯/조각) 표시
- 상세에서 `출전 장착/해제`, `레벨업` 가능
- 상세에서 `일반공격/궁극기` 설명을 함께 확인 가능
- 중앙의 장비 아이콘(무기/투구/갑옷/장신구)을 터치하면 장비 상세/교체 팝업이 열림
- 장착된 장비 아이콘에는 장비 이름이 함께 표시됨
- 출전중인 영웅은 `뒤로 이동/앞으로 이동`으로 편성 순서를 조정 가능
  - 편성 순서 기준: `1번=후열`, `마지막 번호=전열`
- 상세 화면에서 영웅별 패시브 3개와 해금 레벨 확인 가능

## 영웅 뽑기
- `1회 뽑기`, `10회 뽑기` 제공
- 결과는 신규/중복(조각 획득)으로 반영
- 최근 뽑기 결과 목록 확인 가능
- 장비 뽑기
  - `장비 1회/10회` 제공
  - 장비는 무기/투구/갑옷/장신구 타입으로 획득됨
  - 장비 효과는 스탯(공격/체력/보호막/치명) 및 스핀 표식 확률에 반영됨

## 룬 규칙
- 룬 심볼은 **현재 출전(장착)한 영웅 초상(그림)** 으로만 구성됩니다.
- 영웅 룬은 해당 영웅의 역할 행동을 발동합니다.
- 전투불능 영웅도 심볼로 등장하지만, 해당 영웅은 행동하지 못합니다.
- `꽝 룬(🪨)`이 등장할 수 있으며, 발동 시 낙석이 아군 1명에게 떨어져 피해를 입힙니다.
- 기본 타겟 규칙: 단일 공격은 기본적으로 `가장 앞 적(전열)`을 우선 공격합니다.
- 영웅/몬스터마다 기본 타겟 규칙이 다를 수 있습니다.
  - 예: 일부 영웅은 `후열 우선`, 일부 적은 `후열/저체력` 우선 타겟
- 룬 해석 시 1→2→3번째 심볼이 순서대로 상승/강조되며, 해당 심볼 주체가 순차 행동합니다.
- 스핀 표식 시스템(보상 특성으로 확률 강화 가능):
  - `x2 표식`: 해당 심볼이 같은 턴에 2회 행동
  - `리롤 표식`: 해당 심볼 처리 후 좌측부터 다시 해석(턴당 1회)
  - `과충전 표식`: 해당 심볼 위력이 강화되어 강하게 행동
  - `메아리 표식`: 해당 심볼이 60% 위력으로 1회 추가 발동
  - `특수 심볼(와일드 룬)`: 최고 공격 영웅이 즉시 추가 행동
  - `확장 릴(➕)`: 일정 확률로 보너스 릴 1칸이 추가 발동
  - `선두 복제(⧉)`: 일정 확률로 3번째 심볼이 1번째 심볼로 복제
  - `꽝 정화(🧬)`: 일정 확률로 꽝 심볼 1개가 생존 영웅 심볼로 변환
  - `룬 각인(✶+)`: 심볼 1개가 강화되어 해당 행동의 위력이 상승
  - `연쇄 고리(⇉)`: 표식이 붙은 심볼 발동 후 다음 칸이 선행 발동
  - `2번 슬롯 공명(Ⅱ)`: 2번 슬롯이 강화되어 발동 위력이 크게 증가
  - `각성 문장(◆)`: 영웅 심볼 발동 시 2턴 동안 영웅 고유 문장 효과 활성화
    - 란스/베라/미라/킨: 공격 특화 문장
    - 브란: 행동 시 추가 보호막
    - 아이리스: 행동 시 약한 아군 보조 회복
  - `삼연 속사 잠재`: 킨이 잠재능력을 획득한 상태에서 `x2`가 붙으면 3연속 발동
- 생존 영웅이 적을수록(1~2명) 스핀 결과에 영웅 룬이 최소 2개 보정되어 턴 무효감을 줄입니다.
- 전투 불능 영웅도 룬 풀에 남아 등장합니다(등장 확률은 낮게 적용).
- `추모 정렬(🪦)` 스킬로 전투불능 영웅 심볼 등장 확률을 더 낮출 수 있습니다.
- 룬이 연속 해석될수록 연계 배율이 상승해 이번 턴 화력이 증가합니다.
- 전투 불능 아군 수만큼 생존 아군 공격 보정이 적용됩니다(전투불능 1명당 +2).
- 영웅이 행동할 때 에너지가 쌓이며 100%일 때 해당 영웅 룬이 궁극기로 강화됩니다.
- 룬 조합 시너지:
  - 쌍룬 공명: 턴 화력/치명 소폭 상승
  - 삼중 공명: 턴 화력 대폭 상승 + 추가 보정
  - 연계 진형(서로 다른 영웅 3개): 협력 보정으로 화력/치명 상승

## 인게임 스킬 개편 (최신)
- 보상 스킬은 3축만 사용합니다.
  - `심볼 관련 스킬`: x2/리롤/과충전/메아리/와일드/룬각인/각성문장
  - `슬롯 관련 스킬`: 확장 릴/선두 복제/꽝 정화/연쇄 고리/2번 슬롯 공명/추모 정렬
  - `영웅 전용 스킬(잠재능력)`: 영웅마다 3개, 해당 영웅 생존 시에만 보상 카드로 등장
- 단순 스탯 상승형 런 스킬(공격+N, 치명+N%) 카드는 보상 풀에서 제거되었습니다.
- 잠재능력은 전투에서 즉시 체감되는 트리거형 효과로 구성됩니다.
  - 란스: 돌격 연쇄 / 분노 반격 / 갑주 파쇄
  - 베라: 그림자 추격 / 치명 낙인 / 처형 준비
  - 미라: 과열 회로 / 잔류 폭발 / 초신성
  - 브란: 반격 갑주 / 수호 전개 / 최후의 불굴
  - 아이리스: 생명의 파동 / 수호 기도 / 새벽의 기적
  - 킨: 관통 화살 / 삼연 속사 / 매의 사인

## 추가 고도화 (5회 반영)
- 시각 1차: 전장에 오라/먼지 레이어, HUD 오버레이, 유닛 아이들 모션을 추가했습니다.
- 시각 2차: 피해/회복/보호막 플로팅 텍스트 색상을 분리하고 타격 시 전장 흔들림을 보강했습니다.
- 시스템 3차: 영웅별 고유 특성(전선 압박/처형자/원소 증폭/선봉 방패/치유 공명/헌터 본능)을 추가했습니다.
- 코어 4차: 스핀 표식에 `과충전(▲)`/`메아리(∞)`를 추가하고 보상 특성으로 확률 강화가 가능해졌습니다.
- 밸런스 5차: 10스테이지 기준 적 성장 곡선/휴식 회복량/보상량을 재조정했습니다.

## 추가 고도화 (최근 3회)
- 1차(UI): 메인 로비 챕터 패널의 배경 가림을 줄이고(중앙 박스 제거 + 패널 투명화), 화살표/텍스트 대비를 개선했습니다.
- 2차(전투/보상): 보상 카드에 `프리미엄` 등급을 도입하고, 런 내 동일 특성 중복 노출을 줄여 빌드 선택의 다양성을 높였습니다.
- 3차(메타): 영웅 뽑기에 `SR+ 보장(최대 10회)`을 추가해 장기 플레이에서 수집 스트레스를 완화했습니다.

## 전투 화면 구성
- 전장 배경이 전체 화면을 채우고, 상단 HUD는 반투명 오버레이로 배치됩니다.
- 런 보드는 제거하고, 획득한 `런 특성/유물`만 좌측 상단 아이콘으로 표시합니다.
- 캐릭터 라인은 화면 중단(횡 대치) 기준으로 유지됩니다.
- 유닛 카드는 `상단 체력바 + 대형 초상 + 하단 궁극기/의도 표시` 구조로 단순화됩니다.
- 궁극기 발동 시 `필살기 컷인` 연출(영웅명/직업 표기 + 전장 톤 전환 + 대상 강조)이 출력됩니다.
- 근접형 유닛은 타겟 앞으로 돌진해 타격하고, 원거리형 유닛은 투사체를 발사해 공격합니다.
- 타격 직전 타겟 고정 마커(십자/링)와 이동 투사체를 함께 표시해 피격 대상을 명확히 보여줍니다.
- 영웅/적마다 타격 템포(돌진 속도, 접촉 유지 시간, 임팩트 크기)가 다르게 적용됩니다.
- 피격 시 버스트/쇼크웨이브 기반의 강한 피격 효과가 적용됩니다.
- 전투 중 캐릭터별 성격 대사(진지/코믹/분노/차분)가 상황별로 랜덤 출력됩니다.
  - 상황 예시: 전투 시작, 스핀 시작, 공격/치명타, 궁극기, 저체력, 처치, 보스 격노
  - 스핀 대기 상태(`회전` 버튼 누르기 전)에도 감정형 대사가 4~8초 간격으로 출력됩니다.
- 전투 로그는 캐릭터 라인 하단의 고정 영역에 표시됩니다.
- 슬롯 3칸은 하단 중앙 정렬, `회전` 버튼은 그 아래에 배치됩니다.

## 적 의도 시스템
- 각 적 카드에 다음 행동 의도(아이콘/이름/예상 피해)가 표시됩니다.
- 의도는 적 행동 후 갱신됩니다.
- 보스는 체력 50% 이하에서 격노 상태로 전환되어 공격과 내구가 강화됩니다.

## 노드 변주 시스템
- `정예` 노드는 강화된 적 편성과 추가 유산 결정 보상을 제공합니다.
- `휴식` 노드는 전투 없이 2가지 캠프 선택지 중 하나를 고를 수 있습니다.
  - 캠프 정비: 체력/보호막 회복
  - 구조 작전: 전투불능 복귀 또는 전원 생존 시 공격 보너스

## 유물 시스템
- 보상 선택지에 유물 카드가 등장할 수 있습니다.
- 유물은 런 동안 상시 적용되며 중복 획득되지 않습니다.
- 대표 효과:
  - 피해 증폭
  - 에너지 충전 가속
  - 전투 시작 보호막 부여

## 궁극기 시스템
- 각 영웅 카드 하단에 궁극기 게이지가 표시됩니다.
- 게이지 100% 도달 시 다음 해당 영웅 행동이 궁극기로 실행됩니다.
- 궁극기는 일반 행동보다 강한 고유 효과를 가지며 발동 후 게이지는 0%로 초기화됩니다.

## 패시브 시스템
- 영웅마다 패시브 스킬 3개를 보유합니다.
- 패시브 해금 레벨: `Lv.2 / Lv.5 / Lv.8`
- 해금된 패시브는 전투에 자동 적용됩니다.
  - 예: 전열/후열 대상 추가 피해, 전투 시작 보호막/에너지, 행동 후 보조 회복 등

## 잠재능력 시스템
- 영웅마다 런 중 획득 가능한 전용 잠재능력 3개를 보유합니다.
- 보상 카드에서 잠재능력은 해당 영웅이 생존 중일 때만 등장합니다.
- 잠재능력은 일반공격/궁극기/피격/처치 상황에 강한 추가 연출과 효과를 부여합니다.
- 영웅 상세 화면에서 잠재능력 목록과 현재 런 획득 여부를 함께 확인할 수 있습니다.

## 메타 시스템
- 전투/노드/클리어 결과로 `유산 결정`을 획득합니다.
- 유산 결정은 로비 화면에서 영구 강화 + 영웅 성장 + 영웅 뽑기에 사용됩니다.
  - `공격 단련`: 영웅 기본 공격 +1 (최대 5)
  - `생존 단련`: 영웅 기본 체력 +4 (최대 5)
  - `전술 단련`: 전투 위력 +4% (최대 5)
- 영웅 뽑기:
  - 소환 비용: `24 결정`
  - 뽑기 결과가 신규면 영웅 해금
  - 중복이면 해당 영웅 조각 추가 획득
  - `SR+ 보장`: R 등급이 9회 연속 나오면 다음 뽑기에서 SR 이상 확정
- 영웅 성장:
  - 보유 영웅별 `Lv.1 ~ Lv.10`
  - 성장 시 영웅 고유 성장치(공격/체력)가 다음 런부터 적용
  - 성장 비용: 영웅 조각 + 유산 결정
- 전투 시작 기본 스탯은 `직업 보정 + 등급 보정(R/SR/SSR)`이 반영되어 차등 적용됩니다.
- 장비 시스템:
  - 슬롯: 무기/투구/갑옷/장신구(영웅당 4슬롯)
  - 장비 장착은 영웅 상세 화면에서 설정
  - 장착 장비 효과는 런 시작 시 전투 스탯/스핀 확률 보정으로 적용
- 메타 데이터는 브라우저 `localStorage`에 저장됩니다.

## 밸런스 조정 (최신)
- 전투 밸런스
  - 10스테이지 기준으로 적 체력/공격 성장 곡선을 완만하게 재조정했습니다.
  - 전투 시작 시 기본 보호막(+3)으로 초반 안정성을 높였습니다.
  - 챕터 난이도 배율(2/3챕터)을 미세 조정했습니다.
- 보상 밸런스
  - 노드/정예/클리어/후퇴 보상량을 10스테이지 길이에 맞춰 재조정했습니다.
  - 높은 챕터의 보상 배율은 유지 강화해 도전 보상 체감을 보완했습니다.
- 스핀 특성 밸런스
  - `x2/리롤/과충전/메아리/특수 심볼/확장 릴/선두 복제/꽝 정화/룬 각인/연쇄 고리/2번 슬롯 공명/각성 문장/추모 정렬` 확률 상승 수치를 과도 중첩되지 않게 조정했습니다.
  - 3지선다 보상에서 스핀 특성은 한 번에 과다 중첩되지 않도록 구성했습니다.

## 프로토 범위
- 한 런 내부 수집/성장 + 최소 메타 성장 구현
- 계정/클라우드 동기화 없음(로컬 저장만)
- 정식 상점/경제 루프는 미구현(프로토타입 범위 밖)
